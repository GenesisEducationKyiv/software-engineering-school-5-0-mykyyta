# Logger Package

Простий і зручний логер для всіх мікросервісів на базі Zap.

## Основні можливості

- **Структурований логінг** в JSON форматі для production
- **Зручний логінг** для development (читабельний формат)
- **Розумне семплування** - зменшує кількість Info логів без втрати важливих повідомлень
- **Контекстна інформація** - автоматично додає назву сервісу до всіх логів

## Як використовувати

```go
import "your-project/pkg/logger"

// Створити логер
logger, err := logger.New(logger.Config{
    Service: "weather-service",
    Env:     "production", // або "dev"
    Level:   "info",       // debug, info, warn, error
})
if err != nil {
    panic(err)
}

// Додавання логеру контексту
ctx := logger.With(context.Background(), logger)

// Отримання логера з контексту
ctxLogger := logger.From(ctx)
ctxLogger.Info("Processing request", 
    "request_id", logger.GetRequestID(ctx),
    "correlation_id", logger.GetCorrelationID(ctx))

// Безпечне логування email
email := "user@example.com"
logger.Info("User registered", "user_hash", logger.HashEmail(email))
```

## Семплування

В production режимі:
- **Info рівень**: семплується (перші 50 за секунду, потім кожен 50-й)
- **Debug, Warn, Error, Fatal**: ніколи не семплуються

Це зменшує навантаження від частих HTTP запитів, але зберігає всі важливі помилки для моніторингу.

## Оточення

- **Development** (`dev`): всі логи без семплування, читабельний формат
- **Production**: JSON формат, семплування Info логів

## Методи

- `Debug()` - для налагодження
- `Info()` - для загальної інформації (HTTP запити, стан системи)
- `Warn()` - для попереджень
- `Error()` - для помилок
- `Fatal()` - для критичних помилок (завершує програму)

## Моніторинг та алерти

### Рекомендовані алерти

**Критичні (негайна реакція):**
- `Error Rate > 5%` - високий рівень помилок може вказувати на проблеми з БД або зовнішніми API
- `Response Time > 2s` - повільні запити погіршують UX та можуть вказувати на проблеми продуктивності
- `Service Down` - відсутність Info логів за останні 2 хвилини означає проблеми із сервісом

**Попереджувальні (моніторинг тенденцій):**
- `Slow Requests > 10/min` - збільшення кількості повільних запитів (>1s)
- `Warning Rate > 1%` - зростання Warning логів може вказувати на потенційні проблеми
- `Memory/CPU Usage > 80%` - високе використання ресурсів

### Чому саме ці алерти?
- **Error Rate** - критично для SLA та швидкого виявлення проблем
- **Response Time** - впливає на користувацький досвід погодного API
- **Service Health** - раннє виявлення збоїв мікросервісів
- **Resource Usage** - попередження перевантаження системи

## Політика зберігання логів

### Терміни зберігання

**Production логи:**
- **Error/Fatal**: 90 днів (довготривалий аналіз проблем)
- **Warn**: 30 днів (моніторинг тенденцій)
- **Info (HTTP)**: 14 днів (операційна діагностика)
- **Debug**: не логуються в production

**Development логи:**
- Всі рівні: 7 днів (локальна розробка)

### Архівування та очищення

**Автоматичне архівування:**
- Error логи старше 30 днів → архів (S3/холодне сховище)
- Info логи старше 7 днів → компресія та архівування
- Автоматичне видалення архівів старше 1 року

### Обґрунтування рішень

**Чому такі терміни?**
- **Error логи довго** - критично для post-mortem аналізу та виявлення патернів
- **Info логи коротко** - через семплування та великий об'єм, основний фокус на поточних операціях
- **Development коротко** - швидкий feedback loop, не потребує довготривалого зберігання

**Переваги:**
- Оптимізація витрат на зберігання
- Швидкий пошук в актуальних логах
- Збереження критичної інформації для аналізу
